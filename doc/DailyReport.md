# Daily Report - 2026-02-09

## 📅 작업 요약
오늘은 **V1.099 → V1.123** (총 25개 빌드)을 배포하며, **1) 종목 상세 차트 고도화**, **2) 내 주식 인사이트 신규 페이지**, **3) 거래내역 매입단가 자동계산**, **4) 시장 지수 비교 기능**, **5) 조건검색(HTS 0330) 기능 구현 및 안정화** 등 대규모 기능 개발과 버그 수정을 수행했습니다.

---

## 🛠️ 주요 변경 사항

### 1. 종목 상세 차트 고도화 (V1.099 ~ V1.100)
- **차트 기간 축소**: 60일 → 30일로 변경하여 최근 추세 가독성 향상.
- **매입단가 기준선**: 차트 내 점선 추가로 현재가와 직관적 비교 가능.
- **이동평균선 색상**: 범례와 실제 라인 색상 정확히 일치시킴.
- **KOSPI 지수 미표시 수정**: API 필드명(`stck_clpr` vs `bstp_nmix_prpr`) 매핑 오류 해결.

### 2. 거래내역 기능 강화 (V1.101 ~ V1.103)
- **KOSPI Auto-fill**: 거래 날짜 입력 시 KOSPI 지수 자동 조회.
- **거래 수정(Edit) 기능**: 날짜, 수량, 가격 변경 가능한 수정 버튼 추가.
- **매입단가 자동 재계산**: 거래내역 변경 시 Moving Average 방식으로 자동 계산.
- **전체 재계산 버튼**: 과거 데이터 오류 일괄 정상화 기능 추가.

### 3. UI/UX 개선 (V1.104 ~ V1.106)
- **목표가 수익률 배지**: 매도 목표가 설정 시 기대 수익률(%) 실시간 표시. 수익(+) 빨간색, 손실(-) 파란색.
- **텍스트 간소화**: '매도 하한 목표' → '하한 목표', '매도 상한 목표' → '상한 목표'.
- **포트폴리오 카드 레이아웃 고정**: 종목명 길이에 따른 카드 높이 불일치 해결. 미국 주식 `$` 표기 적용.

### 4. 시장 지수 비교 기능 (V1.107 ~ V1.111)
- **Index Comparison**: 종목 상세 모달 내 벤치마크 지수(KOSPI/S&P500) 대비 내 수익률 비교 기능 신설.
- **KOSPI 수동 입력**: 자동 조회 실패 시 수동 입력 기능 및 보호 로직 적용.
- **오버레이 팝업 전환**: 인라인 방식에서 넓은 별도 모달 방식으로 변경.
- **수량/합계 컬럼 추가**: 거래건별 투자 규모 파악 용이.

### 5. 내 주식 인사이트 (V1.112 ~ V1.116)
- **신규 페이지**: `/insights` 경로에 보유 종목의 목표가 근접도 시각화 페이지 추가.
- **차트 분리**: 상한/하한 목표를 각각 독립된 블록(Grid)으로 표시.
- **긴급 알림**: 목표가까지 10% 미만인 경우 금색 테두리 하이라이트.
- **포트폴리오 구성 분석**: 도넛 차트 + Top 5 종목 리스팅 기능 추가.

### 6. 조건검색 HTS 0330 구현 (V1.117 ~ V1.123)
- **기본 검색**: 시가총액, 영업이익률, 성장률, 부채비율, PER 기반 필터링.
- **매출액/배당수익률**: 추가 필터 항목 구현.
- **Range Search**: 슬라이더 → Min/Max 입력 필드로 전환하여 정밀 검색.
- **투자의견 (HTS 0640)**: 증권사 투자의견, 목표가, 작성자 정보 조회 기능 추가.

---

## 🔴 반복 버그 수정 디테일 리포트

> [!CAUTION]
> 아래는 오늘 **반복적으로 발생하여 여러 차례 수정**된 버그들입니다. 근본 원인과 해결 과정을 상세히 기록합니다.

### 🐛 버그 1: 가격 데이터 접근 오류 (V1.112 → V1.112.1 → V1.112.2) — **3회 수정**

| 차수 | 버전 | 증상 | 원인 | 수정 내용 |
|------|-------|------|------|-----------|
| 1차 | V1.112 | 인사이트 차트에 종목 데이터 미표시 | 장 종료 후 현재가(`stck_prpr`)가 0 반환 | 전일 종가(`stck_sdpr`)를 대체 가격으로 사용 |
| 2차 | V1.112.1 | 가격이 여전히 0으로 표시 | 같은 원인의 해외 종목 케이스 미처리 | 해외 종목 필드(`last` → `base`) 대체 로직 추가 |
| 3차 | V1.112.2 | **앱 크래시** + Price 0 | API 응답이 이미 언랩핑(`output` 제거)된 상태인데 `data.output.stck_prpr`로 접근 | `data.stck_prpr`로 직접 참조 + `undefined` 안전장치 |

**근본 원인 분석**: API 응답 구조(`output` 래퍼 존재 여부)가 엔드포인트마다 다르며, 장 종료 시간대에 현재가가 0으로 반환되는 케이스를 초기 설계에서 고려하지 않음. **향후 대책**: API 응답 스키마를 표준화하는 유틸리티 함수 도입 권장.

---

### 🐛 버그 2: 조건검색 API 반복 실패 (V1.117 → V1.121 → V1.122 → V1.123) — **4회 수정**

| 차수 | 버전 | 증상 | 원인 | 수정 내용 |
|------|-------|------|------|-----------|
| 1차 | V1.117 | 사이드바 미표시 + 검색 결과 없음 | `SidebarLayout` 미적용 + 기본 시가총액 필터가 너무 높음(1조) | 레이아웃 적용 + 기본값 1,000억으로 하향 |
| 2차 | V1.121 | **500 Server Error** | Range 파라미터(Min/Max) 처리 누락 + `fetchFinancials` 예외 미처리 | 백엔드 `ranking/simple` API 전면 재작성 + 안전장치 추가 |
| 3차 | V1.122 | **500 Error (Timeout)** | Rate Limiter가 ~3 req/sec로 너무 타이트 → 대량 재무 데이터 조회 시 타임아웃 | Rate Limiter를 ~20 req/sec로 완화 + 병렬 처리 확대 |
| 4차 | V1.123 | **500 Error 지속** | 잘못된 KIS API 엔드포인트 사용 (`FHPST01740000` → `FHPST01730000`) | 검증된 `getMarketCapRanking()` 함수 재사용으로 근본 해결 |

**근본 원인 분석**: 조건검색 기능이 기존에 검증된 시가총액 랭킹 API를 재사용하지 않고 새로운 엔드포인트를 시도하면서 반복적으로 실패. 또한 KIS API의 Rate Limit과 대량 데이터 조회 간의 균형 설정이 부족했음. **향후 대책**: 새로운 KIS API 엔드포인트 도입 시 반드시 단위 테스트 후 적용. 검증된 유틸리티 함수 우선 재사용.

---

### 🐛 버그 3: 인사이트 차트 표시 관련 연쇄 수정 (V1.112 → V1.113 → V1.114 → V1.115) — **4회 변경**

| 차수 | 버전 | 작업 내용 |
|------|-------|-----------|
| 1차 | V1.112 | 초기 구현: Diverging Bar Chart (상한/하한 통합) |
| 2차 | V1.113 | 사용성 개선 요청: 상한/하한 탭 분리 + Simple Bar Chart 전환 |
| 3차 | V1.114 | 탭 방식 → 블록(Grid) 분리 + 차트 클릭 시 상세 모달 연동 |
| 4차 | V1.115 | 긴급 알림: 10% 미만 근접 종목 금색 하이라이트 추가 |

**분석**: 이 케이스는 버그가 아닌 **UX 요구사항의 반복 변경**에 해당합니다. 초기 설계 단계에서 충분한 UX 프로토타이핑이 이루어졌다면 변경 횟수를 줄일 수 있었을 것입니다.

---

## 📊 오늘의 빌드 통계

| 항목 | 수치 |
|------|------|
| **총 빌드 수** | 25개 (V1.099 ~ V1.123) |
| **신규 기능** | 12개 |
| **버그 수정** | 7개 |
| **UI/UX 개선** | 6개 |
| **반복 수정된 버그** | 3건 (총 11회 수정) |

## 🚀 Next Steps
- **조건검색 안정화**: 대량 종목 검색 시 타임아웃 방지를 위한 캐싱 도입 검토.
- **API 응답 표준화**: KIS API 응답 래퍼(`output`) 처리를 일관되게 하는 유틸리티 함수 생성.
- **인사이트 고도화**: 포트폴리오 구성 분석에 섹터별 분류 및 리밸런싱 제안 기능 추가.
